<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="adm.template_application_menu_family_info">
        <t t-call="website.layout">
            <t t-set="title">Application</t>
            <link rel="stylesheet" href="/adm/static/css/form_application.css"/>
            <div class="oe_struture"/>
            <div class="oe_struture">
                <t t-call="adm.template_application_menu"/>

                <div t-att-value="application_id" id="application_id" class="d-none"/>

                <t t-set="house_ids" t-value="application.sudo().partner_id.parent_id.house_address_ids"/>
                <div class="container-fluid d-flex p-4">
                    <style>
                        section {
                            margin-top: 8px;
                        }
                    </style>
                    <article class="row card card-body d-none pt-0" id="form-template">
                        <div class="row">
                            <section class="col-12 d-flex justify-content-end pt-2 pb-1 m-0">
                                <button type="button" class="btn btn-danger remove-contact">&#10006;</button>
                            </section>
                        </div>
                        <div class="row">
                            <div class="col-12 col-md-6 inputFile">

<!--   <input class="required" id="new_file_upload" type="file" name="new_file_upload"/>-->
                            </div>
                            <div class="col-12 col-md-6">
                                <section class="col-12 col-md">
                                    <label>
                                        Type:
                                        <span class="text-danger"> *</span>
                                    </label>
                                    <select required="required" class="form-control" name="contact_type_select">
                                        <option value="new">New contact</option>
                                        <option value="existing">Existing contact</option>
                                    </select>
                                </section>
                                <section class="col-12 col-md">
                                    <label>
                                        Contact Name:
                                        <span class="text-danger"> *</span>
                                    </label>
                                    <select required="required" class="form-control" name="contact_existing_id" disabled="disabled">
                                        <option value=""/>
                                        <t t-foreach="partners" t-as="partner">
                                            <option t-att-value="partner.id">
                                                <t t-esc="partner.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </section>
                            </div>
                        </div>

                        <div class="row new-contact-form">
                            <input required="required" class="form-control" type="hidden" name="new_contact_id" value="-1"/>
                            <!--<section class="col-12 col-md-8">
                                <label>
                                    Parentâ€™s Full Name
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_name" class="form-control"/>
                            </section>-->
                            <section class="col-12 col-md-3">
                                <label>
                                    First name
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_first_name" class="form-control firstname checkDuplicated"/>
                            </section>
                            <section class="col-12 col-md-3">
                                <label>
                                    Middle name
                                </label>
                                <input type="text" name="new_partner_middle_name" class="form-control"/>
                            </section>
                            <section class="col-12 col-md-3">
                                <label>
                                    Last name
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_last_name" class="form-control lastname checkDuplicated"/>
                            </section>
                            <section class="col-12 col-md-3">
                                <label>
                                    Phone
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_mobile" class="form-control phone checkDuplicated"/>
                            </section>

                            <section class="col-12 col-md-4">
                                <label>
                                    Homephone
                                </label>
                                <input required="required" type="text" name="new_partner_phone" class="form-control"/>
                            </section>

                            <section class="col-12 col-md-4">
                                <label>
                                    Email of Parent:
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_email" class="form-control email checkDuplicated"/>
                            </section>

                            <section class="col-12 col-md">
                                <label>Nationality:</label>
                                <select class="country form-control" name="new_partner_nationality">
                                    <option selected="selected" disabled="disabled">Select a country
                                    </option>
                                    <t t-foreach="countries" t-as="country">
                                        <option t-att-value="country.id" t-field="country.name"/>
                                    </t>
                                </select>
                            </section>


                            <section class="col-12 col-md">
                                <label>
                                    House
                                    <span class="text-danger"> *</span>
                                </label>
                                <select required="required" class="form-control" type="text" name="new_relationship_house">
                                    <t t-foreach="house_ids" t-as="house_address">
                                        <option t-att-value="house_address.id">
                                            <t t-esc="house_address.name"/>
                                        </option>
                                    </t>
                                </select>
                            </section>

                            <section class="col-12  col-md-6">
                                <label>
                                    Marital Status:
                                    <span class="text-danger"> *</span>
                                </label>
                                <select required="required" class="form-control" type="text" name="new_partner_marital_status">
                                    <option value="married">Married</option>
                                    <option value="single">Single</option>
                                    <option value="divorced">Divorced</option>
                                    <option value="widowed">Widowed</option>
                                </select>
                            </section>

                            <section class="col-12  col-md-6 col-md-6 mt-auto mb-auto sectionNewRadioSaved" >
                                <label>
                                    Title:
                                </label>
                                <input class="ml-2 newRadio" type="radio" name="title" value="Mr." />
                                <label class="ml-1" for="mr">Mr.</label>
                                <input class="ml-2 newRadio" type="radio"  name="title" value="Ms."/>
                                <label class="ml-1" for="ms">Ms.</label>
                                <input class="ml-2 newRadio" type="radio" name="title" value="Mrs."/>
                                <label class="ml-1" for="mrs">Mrs.</label>
                                <input class="ml-2 newRadio" type="radio" name="title" value="other"/> <label for="other">Other</label>
                                <input class="ml-1" type="text" name="other_reason" style="border: solid 1px #ced4da;"/>
                            </section>


                            <section class="col-12 col-md-6">
                                <label>
                                    Passport Number:
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_identification" class="form-control"/>
                            </section>


                            <section class="col-12 col-md-4">
                                <label>
                                    Title, Occupation, and Employer:
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_occupation" class="form-control"/>
                            </section>

                            <section class="col-12 col-md-4">
                                <label>
                                    Office Address:
                                </label>
                                <input required="required" type="text" name="new_partner_office_address" class="form-control"/>
                            </section>

                            <section class="col-12 col-md-4">
                                <label>
                                    Office Phone:
                                    <span class="text-danger"> *</span>
                                </label>
                                <input required="required" type="text" name="new_partner_office_phone" class="form-control"/>
                            </section>

                            <section class="col-12 col-md">
                                <label>
                                    Type
                                    <span class="text-danger"> *</span>
                                </label>
                                <select required="required" class="form-control" type="text" name="new_relationship_type">
                                    <option value="sibling">Sibling</option>
                                    <option value="father">Father</option>
                                    <option value="mother">Mother</option>
                                    <option value="uncle">Uncle</option>
                                    <option value="grandmother">Grandmother</option>
                                    <option value="grandfather">Grandfather</option>
                                    <option value="other">Other</option>
                                </select>
                            </section>
                            <section class="col-12 col-md-6">
                                <label>Is an emergency contact?</label>
                                <input class="true-emergency-contact" type="checkbox" value="True" name="new_relationship_is_emergency_contact"/>
                                <input class="false-emergency-contact" type="hidden" value="" name="new_relationship_is_emergency_contact" checked="checked"/>
                            </section>

                            <section class="col-12 col-md-6">
                                <label>Do this parent have parental responsibility for the child?</label>
                                <input type="checkbox" name="new_relationship_is_parental_responsability"/>
                            </section>


                        </div>

                    </article>

                    <main class="col">
                        <form t-att-action="'/admission/applications/{}/write'.format(application_id)" method="post" enctype="multipart/form-data" id="family_form">

                            <input required="required" class="form-control" type="hidden" name="has_contact"/>

                            <section class="container-fluid">
                                <div class="card">
                                    <div class="card-header">
                                        <h1>Family Information</h1>
                                    </div>
                                    <div id="contact_forms" class="card-body">
                                        <t t-if="application_id.status_id.type_id !='return' and application_id.status_id.type_id != 'started'">
                                            <div class="alert alert-warning mt-3" id="requestSent" role="alert">
                                                 The request has already been sent.
                                            </div>
                                        </t>
                                        <t t-else="">
                                            <t t-set="partnerIdx" t-value="0"/>
                                            <t t-foreach="application.sudo().relationship_ids" t-as="relationship">
                                                <article class="row card card-body pt-0" t-att-id="'relationship_{}'.format(relationship_index+1)">
                                                    <t t-set="partner" t-value="relationship.partner_2"/>

                                                    <input required="required" class="form-control" type="hidden" name="contact_id" t-att-value="relationship.partner_2.id"/>
                                                    <div class="row">
                                                        <section class="col-12 d-flex justify-content-end pt-2 pb-1 m-0">
                                                            <button type="button" class="btn btn-danger remove-contact" t-att-data-id="relationship_index+1">&#10006;</button>
                                                        </section>
                                                    </div>
                                                    <div class="row">

                                                        <section class="container col-12 align-items-center mt-3">
                                                            <div class="row">
                                                                <div class="col-8 offset-2 col-md-6 offset-md-3 col-lg-4 offset-lg-4">
                                                                    <div class="text-center">

                                                                        <img t-if="len(person_photos[partnerIdx]) &lt;= 30" src="/adm/static/files/contact_photo_placeholder.png" widget="image" class="avatar rounded" alt="avatar" width="175"/>
                                                                        <img t-else="" t-att-src="person_photos[partnerIdx]" widget="image" class="avatar rounded" alt="avatar" width="175"/>
                                                                        <h6 class="mt-2 textUpload">Upload a different photo...</h6>

                                                                        <input required="required" type="file" name="file_upload" class="form-control"/>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row mt-2" style="height: 40px;">
                                                                <div class="form-group col-12 col-md-8 offset-md-2">
                                                                    <input required="required" type="text" disabled="disabled" t-att-value="partner.name" class="form-control"/>
                                                                </div>
                                                            </div>
                                                        </section>

                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Phone
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required"  readonly="readonly" type="text" t-att-value="partner.mobile" class="form-control" name="relation_partner_mobile"/>
                                                        </section>

                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Homephone
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required" type="text" t-att-value="partner.phone" class="form-control" name="relation_partner_phone"/>
                                                        </section>

                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Email
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required" readonly="readonly" type="text" t-att-value="partner.email" class="form-control checkEmailExisted" name="relation_partner_email"/>
                                                        </section>

                                                        <section class="col-12 col-md">
                                                            <label>
                                                                Type
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <select required="required" class="form-control" type="text" name="relationship_type">
                                                                <option value="sibling" t-att-selected="relationship.relationship_type == 'sibling'">Sibling</option>
                                                                <option value="father" t-att-selected="relationship.relationship_type == 'father'">Father</option>
                                                                <option value="mother" t-att-selected="relationship.relationship_type == 'mother'">Mother</option>
                                                                <option value="uncle" t-att-selected="relationship.relationship_type == 'uncle'">Uncle</option>
                                                                <option value="grandmother" t-att-selected="relationship.relationship_type == 'grandmother'">Grandmother</option>
                                                                <option value="grandfather" t-att-selected="relationship.relationship_type == 'grandfather'">Grandfather</option>
                                                                <option value="other" t-att-selected="relationship.relationship_type == 'other'">Other</option>
                                                            </select>
                                                        </section>

                                                        <section class="col-12 col-md">
                                                            <label>Nationality:</label>
                                                            <select class="country form-control" name="current_partner_nationality">
                                                                <option disabled="disabled">Select a country
                                                                </option>
                                                                <t t-foreach="countries" t-as="country">
                                                                    <option t-att-value="country.id" t-field="country.name" t-att-selected="partner.citizenship.id == country.id"/>
                                                                </t>
                                                            </select>
                                                        </section>

                                                        <section class="col-12 col-md">
                                                            <label>
                                                                House
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <select required="required" class="form-control" type="text" name="relationship_house">
                                                                <option value=""/>
                                                                <t t-foreach="house_ids" t-as="house_address">
                                                                    <option t-att-value="house_address.id" t-att-selected="house_address.id == partner.house_address_id.id">
                                                                        <t t-esc="house_address.name"/>
                                                                    </option>
                                                                </t>
                                                            </select>
                                                        </section>

                                                        <section class="col-12  col-md-6">
                                                            <label>
                                                                Marital Status:
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <select required="required" class="form-control" type="text" name="current_partner_marital_status">
                                                                <option value="married" t-att-selected="partner.marital_status == 'married'">Married</option>
                                                                <option value="single" t-att-selected="partner.marital_status == 'single'">Single</option>
                                                                <option value="divorced" t-att-selected="partner.marital_status == 'divorced'">Divorced</option>
                                                                <option value="widowed" t-att-selected="partner.marital_status == 'widowed'">Widowed</option>
                                                            </select>
                                                        </section>


                                                        <section class="col-12  col-md-6 col-md-6 mt-auto mb-auto sectionRadioSaved" t-att-id="'title_adm_{}'.format(relationship_index+1)">
                                                            <label>
                                                                Title:
                                                            </label>
                                                            <input class="ml-2 radio" type="radio" t-att-id="'mr_{}'.format(relationship_index+1)"  value="Mr." t-att-checked="partner.title == 'Mr.'"/>
                                                            <label class="ml-1" for="mr">Mr.</label>
                                                            <input class="ml-2 radio" type="radio" t-att-id="'ms_{}'.format(relationship_index+1)" value="Ms." t-att-checked="partner.title == 'Ms.'"/>
                                                            <label class="ml-1" for="ms">Ms.</label>
                                                            <input class="ml-2 radio" type="radio" t-att-id="'mrs_{}'.format(relationship_index+1)"  value="Mrs." t-att-checked="partner.title == 'Mrs.'"/>
                                                            <label class="ml-1" for="mrs">Mrs.</label>
                                                            <input class="ml-2 radio" type="radio" t-att-id="'other_{}'.format(relationship_index+1)"  value="other" t-att-checked="partner.title not in ('Mr.','Ms.','Mrs.')"/>
                                                            <label class="ml-1" for="other">Other</label>
                                                            <input class="ml-2" type="text" t-if="partner.title not in ('Mr.','Ms.','Mrs.')" t-att-value="partner.title" name="current_other_reason" />
                                                            <input class="ml-1" style="border: solid 1px #ced4da;" type="text" t-else="" name="current_other_reason" />

                                                        </section>


                                                        <section class="col-12 col-md-6">
                                                            <label>
                                                                Cedula/Passport Number:
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required" type="text"  t-att-value="partner.identification" name="current_partner_identification" class="form-control"/>
                                                        </section>


                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Title, Occupation, and Employer:
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required" type="text" t-att-value="partner.occupation" name="current_partner_occupation" class="form-control"/>
                                                        </section>

                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Office Address:
                                                            </label>
                                                            <input required="required" type="text" t-att-value="partner.work_address" name="current_partner_office_address" class="form-control"/>
                                                        </section>

                                                        <section class="col-12 col-md-4">
                                                            <label>
                                                                Office Phone:
                                                                <span class="text-danger"> *</span>
                                                            </label>
                                                            <input required="required" type="text" t-att-value="partner.work_phone" name="current_partner_office_phone" class="form-control"/>
                                                        </section>


                                                        <section class="col-12 col-md-6">
                                                            <label>Is an emergency contact?</label>
                                                            <input class="true-emergency-contact" type="checkbox" value="True" name="relationship_is_emergency_contact" t-att-checked="relationship.is_emergency_contact"/>
                                                            <input class="false-emergency-contact" type="hidden" value="" name="relationship_is_emergency_contact" checked="checked"/>
                                                        </section>

                                                        <section class="col-12 col-md-6">
                                                            <label>Do this parent have parental responsibility for the child?</label>
                                                            <input type="checkbox" t-att-checked="partner.parental_responsability == True" name="current_relationship_is_parental_responsability"/>
                                                        </section>



                                                    </div>
                                                    <t t-set="partnerIdx" t-value="partnerIdx+1"/>

                                                </article>
                                            </t>
                                            <button type="button" class="add-contact btn btn-secondary d-block mt-2 ml-auto">&#10010; Add family member</button>
                                        </t>
                                    </div>
                                </div>
                                            <script type="text/javascript">
                                                function change_name(){
                                                if(document.getElementById('change_name_div').style.display == 'none')
                                                document.getElementById('change_name_div').style.display = 'block';
                                                else
                                                document.getElementById('change_name_div').style.display = 'none';
                                                }
                                                $(function(){

                                                // write your code here...

                                                });
                                                function addsibling(){
                                                    var itm = document.getElementById("sibling_base_div");

                                                    var cln = itm.cloneNode(true);
                                                    cln.classList.remove("d-none");
                                                    cln.classList.add("d-flex");
                                                    cln.classList.add("flex-wrap");
                                                    cln.classList.add("p-0");
                                                    document.getElementById("sibling_new_div").appendChild(cln);
                                                }
                                            </script>
                                            <t t-if="application_id.status_id.type_id == 'return' or application_id.status_id.type_id == 'started'">
                                                <section class="row">
                                                                <div class="col-12 bg-ia-pan mt-3 mb-2 h4">
                                                        siblings
                                                    </div>
                                                </section>
                                                <section class="row" >
                                                    <div class="col-12 d-none" id="sibling_base_div">
                                                         <div class="col-12 col-md-4 form-group">
                                                            <label>
                                                                Name:
                                                            </label>
                                                            <input  type="text" name="sibling_name" class="form-control"/>
                                                         </div>
                                                         <div class="col-12 col-md-4 form-group">
                                                             <label>
                                                                Age:
                                                             </label>
                                                            <input  type="text" name="sibling_age" class="form-control"/>
                                                         </div>
                                                          <div class="col-12 col-md-4 form-group">
                                                             <label>
                                                                Previous school:
                                                             </label>
                                                            <input  type="text" name="sibling_school" class="form-control"/>
                                                         </div>
                                                         <hr class="col-12 "></hr>
                                                    </div>
                                                    <div class="col-12 d-flex flex-wrap p-0" id="sibling_new_div">
                                                         <t t-foreach="application.siblings" t-as="sibling">
                                                            <div class="col-12 col-md-4 form-group">
                                                                 <label>
                                                                    Name:
                                                                 </label>
                                                                 <input  type="text" name="sibling_name" class="form-control" t-att-value="sibling.name"/>
                                                            </div>
                                                            <div class="col-12 col-md-4 form-group">
                                                                 <label>
                                                                    Age:
                                                                 </label>
                                                                <input  type="number" name="sibling_age" class="form-control" t-att-value="sibling.age"/>
                                                            </div>
                                                            <div class="col-12 col-md-4 form-group">
                                                                 <label>
                                                                    Previous school:
                                                                 </label>
                                                                <input  type="text" name="sibling_school" class="form-control" t-att-value="sibling.school"/>
                                                            </div>
                                                            <hr class="col-12 "></hr>
                                                         </t>
                                                    </div>
                                                    <button type="button" class="ml-auto btn btn-secondary" id="add_sibling_button" onclick="addsibling()">Add sibling</button>
                                                </section>
                                                <section>
                                                    <div class="alert alert-warning text-center" role="alert">
                                                        You need to have minimum one address created in the system to add a family member.
                                                    </div>
                                                </section>
                                            </t>


                                <t t-if="application_id.status_id.type_id =='return' or application_id.status_id.type_id == 'started'">
                                    <button class="d-none" id="submitButton">Submit changes</button>
                                    <div class="btn btn-lg btn-warning d-block col-8 offset-2 col-lg-4 offset-lg-4 col-xl-2 offset-xl-5 mt-2 mb-3" id="submitButtonFake">Submit changes</div>
                                </t>
                            </section>
                        </form>
                        <div class="modal" id="modalError">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <!-- Modal Header -->
                                <div class="modal-header card-header">
                                  <h4 class="modal-title">Issues</h4>
                                  <button type="button" class="close" data-dismiss="modal">X</button>
                                </div>
                                <!-- Modal body -->
                                <div class="modal-body" id="bodyMessageIssue">
                                </div>
                              </div>
                            </div>
                        </div>
                    </main>
                    <script
  src="https://code.jquery.com/jquery-3.5.1.slim.js"
  integrity="sha256-DrT5NfxfbHvMHux31Lkhxg42LY6of8TaYyK50jnxRnM="
  crossorigin="anonymous"></script>
                    <script type="text/javascript" src="/adm/static/js/contact.js"/>
                </div>
            </div>
        </t>
    </template>
</odoo>